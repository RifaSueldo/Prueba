
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Rifa$ueldo - ¡Ganá hasta 12 sueldos y elegí a que Club vas a ayudar con lo recaudado!</title>
  <link rel="icon" href="https://i.ibb.co/nMHBVFXf/logo-R.png" type="image/png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta property="og:title" content="Rifa$sueldo - ¡Ganá hasta 12 sueldos y elegí a que Club vas a ayudar con lo recaudado!" />
<meta property="og:description" content="Comprá tu número online, y recibí tu ticket al instante." />
<meta property="og:image" content="https://i.ibb.co/nMHBVFXf/logo-R.png" />
<meta property="og:url" content="https://rifasueldo12.blogspot.com" />
<meta property="og:type" content="website" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  

  <style>
    body {
      font-family: Arial;
      background: linear-gradient(-90deg, #4C1956, #4C1956, #4C1956, #4C1956, #D14DEB, #4C1956, #4C1956, #4C1956, #4C1956);
      background-size: 400% 400%;
      animation: gradienteMovimiento 6s ease infinite;
      margin: 0;
      padding-top: 80px;
      text-align: center;
      color: #fff;
    }
    @keyframes gradienteMovimiento {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    .rifas-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
    }
    .rifa {
      background: rgba(255, 255, 255, 0.25);
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      width: 100%;
      padding: 6px 6px 6px;
      box-sizing: border-box;
      color: #fff;
    }
    @media (min-width: 768px) {
      .rifas-container { flex-direction: row; }
      .rifa { width: 30%; max-width: 350px; }
    }
    .banner-img {
      width: 100%;
      border-radius: 10px;
      cursor: pointer;
      opacity: 0.65;
      transition: opacity 0.3s ease;
    }
    .banner-img:hover {
      opacity: 1;
    }
    .btn-participar {
      background: #4C1956;
      color: white;
      font-size: 16px;
      padding: 12px;
      width: 100%;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .btn-participar:hover {
      background: #621572;
    }
    .numeros-paginados { margin-top: 10px; display: none; }
    .numeros-container {
      display: flex;
      flex-wrap: wrap;
      gap: 3px;
      justify-content: center;
      margin: 6px 0;
    }
    
    .numero {
      background: #eee;
      color: #4C1956;
      font-weight: bold;
      border-radius: 5px;
      width: 40px;
      height: 34px;
      line-height: 34px;
      cursor: pointer;
      user-select: none;
      text-align: center;
    }
    .numero:hover { background: #cbe4ea; }
    .numero.seleccionado { background: #4C1956; color: white; }
    .numero.tomado {
      background: #ccc;
      color: #777;
      cursor: not-allowed;
    }
    .paginacion {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 4px;
    }
    .paginacion button {
      background: #4C1956;
      color: white;
      border: none;
      padding: 5px 12px;
      border-radius: 5px;
      cursor: pointer;
      user-select: none;
    }
    .paginacion button:disabled {
      background: #aaa;
      cursor: not-allowed;
    }
    form, .ticket {
      background: white;
      padding: 20px;
      max-width: 400px;
      margin: 20px auto;
      border-radius: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      color: #4C1956;
      text-align: left;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      font-size: 16px;
      font-family: inherit;
    }
    button {
      background: #4C1956;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    #toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #0098DA;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      display: none;
      z-index: 9999;
      user-select: none;
    }
    #qrcode {
  display: flex;
  justify-content: center;
  margin: 20px 0;
}
    .oculto { display: none !important; }
    .loading { opacity: 0.6; pointer-events: none; }
    .spinner {
      border: 3px solid #eee;
      border-top: 3px solid #4C1956;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      display: inline-block;
      vertical-align: middle;
      margin-left: 10px;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }
    
    .barra-superior {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 70px;
  background: #4C1956;
  backdrop-filter: blur(5px);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 20px;
  z-index: 9999;
  color: white;
  font-size: 14px;
}

.barra-izquierda img {
  height: 40px;
}

.barra-derecha {
  text-align: right;
  font-size: 13px;
}

.texto-sorteo {
  line-height: 1.2;
}

#contador-sorteo {
  font-weight: bold;
  font-size: 15px;
  color: #FFD700;
}
footer.pie-pagina {
  margin-top: 40px;
  font-size: 14px;
  color: white;
}

.barra-seguridad, .barra-instrucciones, .barra-legales {
  padding: 20px;
  background: rgba(255, 255, 255, 0.06);
  border-top: 1px solid rgba(255, 255, 255, 0.2);
}

.barra-seguridad {
  display: flex;
  flex-wrap: wrap;
  align-items: flex-start;
  justify-content: space-around;
  gap: 20px;
}

.barra-seguridad .logos {
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
  justify-content: center;
}

.barra-seguridad .logos img {
  height: 40px;
  filter: grayscale(100%) brightness(0.9);
  transition: filter 0.3s ease;
}
.barra-seguridad .logos img:hover {
  filter: none;
}

.barra-seguridad .texto {
  text-align: left;
  max-width: 400px;
  line-height: 1.6;
}

.barra-instrucciones p,
.barra-legales p {
  margin: 6px 0;
  text-align: center;
  line-height: 1.6;
}

.barra-legales a {
  color: #ddd;
  text-decoration: underline;
}
.barra-legales a:hover {
  color: #fff;
}

@media (max-width: 600px) {
  .barra-seguridad {
    flex-direction: column;
    align-items: center;
    text-align: center;
  }

  .barra-seguridad .texto {
    text-align: center;
  }
}

.paginacion button.prev,
.paginacion button.next {
  width: 140px;
  height: 34px;
  font-size: 25px;
  line-height: 34px;
  padding: 0;
  margin: 0 5px;
  box-sizing: border-box;
  text-align: center;
  display: flex;
  align-items: center;
  justify-content: center;
  user-select: none;
  background: #621572;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.paginacion button.prev:hover,
.paginacion button.next:hover {
  background: #621572;
}

.paginacion button:disabled {
  background: #621572;
  cursor: not-allowed;
  opacity: 0.4;
}

@media (max-width: 600px) {
  .paginacion button.prev,
  .paginacion button.next {
    width: 140px;
    font-size: 25px;
  }
}
    
    .banner-wrapper {
  position: relative;
  display: inline-block;
  width: 100%;
}

.texto-premio {
  position: absolute;
  top: 33%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: white;
  font-size: 16px;
  font-weight: bold;
  text-shadow: 0 0 4px black;
  pointer-events: none;
  text-align: center;
  width: 100%;
}
    .texto-premio2 {
  position: absolute;
  top: 45%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: white;
  font-size: 25px;
  font-weight: bold;
  text-shadow: 0 0 4px black;
  pointer-events: none;
  text-align: center;
  width: 100%;

  animation: zoomAnim 1.8s infinite ease-in-out;
}

 @keyframes zoomAnim {
  0%   { transform: translate(-50%, -50%) scale(1); }
  50%  { transform: translate(-50%, -50%) scale(1.15); }
  100% { transform: translate(-50%, -50%) scale(1); }
}   
    .texto-premio3 {
  position: absolute;
  top: 60%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: white;
  font-size: 16px;
  font-weight: bold;
  text-shadow: 0 0 4px black;
  pointer-events: none;
  text-align: center;
  width: 100%;
}



.texto-precio {
  position: absolute;
  bottom: 8px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 12px;
  color: white;
  background: rgba(0, 0, 0, 0.5);
  padding: 4px 20px;
  border-radius: 6px;
  min-width: 120px;
  text-align: center;
  pointer-events: none;
  white-space: nowrap;
}


#banner-bienvenida {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0, 0, 0, 0.85);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  padding: 20px;
  box-sizing: border-box;
  animation: slideDownFade 0.7s ease-out forwards;
  opacity: 1; /* arranca visible */
  animation-delay: 0s; /* sin delay */
}

@keyframes slideDownFade {
  0% {
    opacity: 0;
    transform: translateY(-30px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

.banner-contenido {
  width: 100%;
  max-width: 500px;
  background-color: #621572;
  padding: 20px;
  border-radius: 12px;
  text-align: center;
  color: white;
  box-shadow: 0 0 20px #000;
}

.banner-contenido h2 {
  font-size: 1.8rem;
  margin-bottom: 10px;
}

.banner-contenido p {
  font-size: 1rem;
  margin-bottom: 20px;
}

#cerrar-banner {
  
  padding: 10px 20px;
  background-color: #7C0FC4;
  color: white;
  border: none;
  border-radius: 5px;
  font-size: 1rem;
  cursor: pointer;
  transition: background 0.2s ease;
}

#cerrar-banner:hover {
  background-color: #5e0d96;
}

.banner-contenido p {
  line-height: 1.2; /* más compacto que el valor por defecto (1.5 o 1.6) */
  margin: 4px 0;    /* opcional: reduce los márgenes verticales */
}
    
#wa-slidebox {
  position: fixed;
  top: 20%;
  right: 0px;
  height: auto;
  display: flex;
  align-items: center;
  z-index: 9999;
  transform: translateX(calc(100% - 40px)); /* solo la pestaña visible */
  transition: transform 0.4s ease;
}

#wa-slidebox.open {
  transform: translateX(0); /* muestra todo */
}

/* Pestaña lateral */
.wa-tab {
  width: 60px;
  height: 60px;
  background-color: #4C1956;
  border-top-left-radius: 20px;
  
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 22px;
  cursor: pointer;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
}
.wa-tab img {
  width: 28px;
  height: 28px;
  filter: invert(1); /* lo vuelve blanco sobre fondo verde */
  padding-right: 15px;
}
/* Contenido que se desliza */
.wa-content {
  display: flex;
  align-items: center;
  background-color: #fff;
  padding: 15px 15px;
  box-shadow: 0 0 10px rgba(0,0,0,0.2);
  border-bottom-right-radius: 0px;
}

/* Texto mensaje */
.wa-tooltip {
  font-size: 14px;
  color: #333;
  margin-right: 10px;
  white-space: nowrap;
}

/* Botón WhatsApp */
.wa-button {
  background-color: #4C1956;;
  border-radius: 50%;
  padding: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  animation: pulse 2s infinite;
  will-change: transform;
  transform-origin: center center;
}
@keyframes pulse {
  0% {
    transform: scale(1);
    box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.7);
  }
  70% {
    transform: scale(1.1);
    box-shadow: 0 0 10px 10px rgba(37, 211, 102, 0);
  }
  100% {
    transform: scale(1);
    box-shadow: 0 0 0 0 rgba(37, 211, 102, 0);
  }
}


/* Personalización de la scrollbar */

/* Para navegadores basados en WebKit (Chrome, Safari, Edge moderno) */
::-webkit-scrollbar {
  width: 6px; /* ancho de la barra vertical */
  height: 6px; /* ancho barra horizontal, opcional */
}

::-webkit-scrollbar-track {
  background: #000000; /* color fondo barra */
}

::-webkit-scrollbar-thumb {
  background-color: #25D366; /* color "thumb" (parte que se mueve) */
  border-radius: 10px;
  border: 1px solid #000000; /* margen alrededor del thumb */
}

::-webkit-scrollbar-thumb:hover {
  background-color: #128C4A; /* color cuando haces hover */
}

/* Para Firefox */
* {
  scrollbar-width: none; /* opciones: auto, thin, none */
  scrollbar-color: #25D366 #000000; /* thumb color, track color */
}
@media screen and (max-width: 768px) {
  html, body {
    max-width: 100vw !important;
    overflow-x: hidden !important;
    margin: 0;
    padding: 0;
    padding-top: 40px !important;
  }
  
  

  </style>
<link rel="me" href="https://www.blogger.com/profile/09291083959255295073" />
<meta name='google-adsense-platform-account' content='ca-host-pub-1556223355139109'/>
<meta name='google-adsense-platform-domain' content='blogspot.com'/>
</head>
<body>
 <div id="wa-slidebox">
  <div class="wa-tab" id="wa-toggle">  <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/whatsapp.svg" alt="WhatsApp"></div>
  <div class="wa-content">
    <span class="wa-tooltip">¿Dudas? Estamos para ayudarte. &#8594</span>
    <a class="wa-button" href="https://wa.me/5493435020970" target="_blank">
    
    </a>
  </div>
</div>
<div id="banner-bienvenida">
  <div class="banner-contenido">
    <h2>¡Bienvenido a Rifa$ueldo!</h2>
    <p>¡Ganá hasta 12 sueldos</p>
    <p>y elegí que Club u ONG</p>
     <p>recibirá parte de lo recaudado! </p>
    <p>A quién vas a ayudar?</p>
   <img src="https://i.ibb.co/KpTdJBBb/Mujer-pensativa-rodeada-de-preguntas.png"
     alt="Imagen de rifa solidaria"
     style="max-width: 40%; height: auto; margin: -11px 0; position: relative;
            filter: drop-shadow(0 6px 12px rgba(255, 255, 255, 0.2))
                    drop-shadow(0 2px 4px rgba(255, 255, 255, 0.2));" />
    <button id="cerrar-banner">Cerrar</button>
  </div>
</div>

<div class="barra-superior">
  <div class="barra-izquierda">
    <img src="https://i.ibb.co/GvpfKxTm/Rifaok-logo.png" alt="Logo Rifa" />
  </div>
  <div class="barra-derecha">
    <div class="texto-sorteo">Próximo sorteo de 2 cifras:<br>Lotería Nacional Nocturna<br><strong>16-07-2025 21:00:00</strong></div>
    <div id="contador-sorteo"></div>
  </div>
</div>

<div class="rifas-container" id="rifas-contenedor"></div>

<form id="formulario" style="display:none">
  <h3>Completá tus datos</h3>
  <input id="nombre" name="nombre" required placeholder="Nombre y apellido" autocomplete="name" />
  <input id="dni" name="dni" required placeholder="DNI" autocomplete="off" />
  <input id="email" name="email" type="email" required placeholder="Email" autocomplete="email" />
  <input id="telefono" name="telefono" required placeholder="Teléfono" autocomplete="tel" />
  <input id="localidad" name="localidad" required placeholder="Localidad" autocomplete="off" />
  
  <!-- Nuevo campo para código de descuento -->
  <input id="codigo-descuento" name="codigo-descuento" placeholder="Código de descuento (opcional)" autocomplete="new-password" />
  <div id="mensaje-descuento" style="color: green; margin-bottom: 10px; display:none;"></div>

  <div id="numeros-container" class="numeros-container"></div>
  <div style="margin-top: 10px;">
    <strong>Total a pagar: $<span id="total-pagar">0</span></strong>
  </div>
  <button type="submit" id="btn-pagar">
    Continuar con la compra
    <span id="spinner" class="spinner" style="display:none"></span>
  </button>
  <button type="button" id="btn-cancelar" onclick="window.location.href='/'" style="margin-top: 10px; background-color: #ccc; color: #000; border: none; padding: 8px 16px; cursor: pointer;">
    Cancelar compra
  </button>
</form>

<div class="ticket" id="ticket" style="display:none">
  <h3 style="margin: 0; line-height: 1.2; text-align: center;">Este es tu</h3>
<h3 style="margin: 0; line-height: 1.2; text-align: center;">ticket Rifa$ueldo</h3>
  
  <div id="datos"></div>
 <div id="qrcode"></div>
  <button id="descargar">Descargar Ticket</button>
</div>

<div id="toast"></div>



<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbw_k8RqV36_UeTQEqVxOjoa_c98ilaxflVILHlbroLk7nSVonZCdaDMl8fYqNreAchY/exec";

// Configuración de rifas: rifa ID, total números, padding (dígitos), tipo texto, valor y banner
const rifasData = [
  { rifa: 1, total: 100, padding: 2, tipo: "2 cifras", valor: 5000, imagen: "https://i.ibb.co/N6Fm2Sh5/Generated-File-July-07-2025-1-38-AM.gif", estilo: "filter: hue-rotate(0deg); opacity: 0.65;"},
  { rifa: 2, total: 1000, padding: 3, tipo: "3 cifras", valor: 6000, imagen: "https://i.ibb.co/N6Fm2Sh5/Generated-File-July-07-2025-1-38-AM.gif", estilo: "filter: hue-rotate(120deg); opacity: 0.65;" },
  { rifa: 3, total: 10000, padding: 4, tipo: "4 cifras", valor: 8000, imagen: "https://i.ibb.co/N6Fm2Sh5/Generated-File-July-07-2025-1-38-AM.gif", estilo: "filter: hue-rotate(240deg); opacity: 0.65;"}
];

let rifas = [], seleccionadosPorRifa = {}, paginas = {}, vendidosPorRifa = {};
let descuentoAplicado = 0; // porcentaje (ejemplo: 10 = 10%)

const codigosDescuentoValidos = {
  "PROMO10": 10,
  "DESC20": 20,
  "SOLIDARIO5": 5
};

// Mostrar un toast con mensaje
function mostrarToast(msg) {
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.style.display = "block";
  setTimeout(() => t.style.display = "none", 8000);
}

// Refactor para textos según rifa
function getTextoPorRifa(rifa) {
  switch (rifa) {
    case 1:
      return {
        textoPremio: "¡Ganá 2 Sueldos!",
        textoPremio2: "de $170.000",
        textoPremio3: "2 cifras",
        textoPrecio: "Sortea: 16-07-2025 21:00hs | Valor x Núm.: $5.000",
        fechaSorteo: "2025-07-16T21:00:00"
      };
    case 2:
      return {
        textoPremio: "Ganá 6 $ueldos",
        textoPremio2: "de $300.000",
        textoPremio3: "3 cifras",
        textoPrecio: "Sortea: 16-10-2025 21:00hs | Valor x Núm.: $6.000",
        fechaSorteo: "2025-10-16T21:00:00"
      };
    case 3:
      return {
        textoPremio: "Ganá 12 $ueldos",
        textoPremio2: "de $900.000",
        textoPremio3: "4 cifras",
        textoPrecio: "Sortea: 16-01-2026 21:00hs | Valor x Núm.: $8.000",
        fechaSorteo: "2026-01-16T21:00:00"
      };
    default:
      return {};
  }
}

// Renderiza los banners y botones de cada rifa y sus contenedores
function renderRifas() {
  const contenedor = document.getElementById("rifas-contenedor");
  rifasData.forEach((config, idx) => {
    const div = document.createElement("div");
    div.className = "rifa";
    div.dataset.rifa = config.rifa;
    div.dataset.padding = config.padding;
    div.dataset.tipo = config.tipo;
    div.dataset.valor = config.valor;
    div.dataset.total = config.total;

    const textos = getTextoPorRifa(config.rifa);

    div.innerHTML = `
      <div class="banner-wrapper">
        <img class="banner-img" src="${config.imagen}" alt="Banner Rifa ${config.tipo}" style="${config.estilo}" 
          onmouseover="this.style.opacity=1" 
          onmouseout="this.style.opacity=0.65" />
        <div class="texto-premio">${textos.textoPremio}</div>
        <div class="texto-premio2">${textos.textoPremio2}</div>
        <div class="texto-premio3">${textos.textoPremio3}</div>
        <div class="texto-precio">${textos.textoPrecio}</div>
      </div>
      <button class="btn-participar">Desplegar Números</button>
      <div class="numeros-paginados" style="display:none; position:relative;">
  <div class="loading-overlay" style="display:none; position:absolute; top:0; left:0; right:0; bottom:0;
    background: rgba(255,255,255,0.9); color:#333; font-size:1.2rem;
    display:flex; align-items:center; justify-content:center; z-index:10;">
    Cargando números tomados...
  </div>
  <div class="numeros-container"></div>
  <div class="paginacion">
    <button class="prev" aria-label="Anterior">&larr;</button>
    <button class="next" aria-label="Siguiente">&rarr;</button>
  </div>
</div>

      `;

    contenedor.appendChild(div);
    rifas.push(div);
    seleccionadosPorRifa[idx] = new Set();
    paginas[idx] = 0;
    agregarEventosRifa(div, idx);
  });
}

// Agrega eventos a botones y flechas para cada rifa
function agregarEventosRifa(rifa, idx) {
  const btn = rifa.querySelector(".btn-participar");
  const prev = rifa.querySelector(".prev");
  const next = rifa.querySelector(".next");
  const paginados = rifa.querySelector(".numeros-paginados");

  prev.onclick = () => {
    if (paginas[idx] > 0) {
      paginas[idx]--;
      renderNumeros(idx);
    }
  };

  next.onclick = () => {
    const total = parseInt(rifa.dataset.total);
    const maxPage = Math.floor((total - 1) / 50);
    if (paginas[idx] < maxPage) {
      paginas[idx]++;
      renderNumeros(idx);
    }
  };

 btn.onclick = () => {
  const activos = rifas.findIndex(r => r.querySelector(".btn-participar").textContent === "Comprar");
  const overlay = rifa.querySelector(".loading-overlay");

  if (btn.textContent === "Desplegar Números") {
    if (activos !== -1 && activos !== idx && seleccionadosPorRifa[activos].size > 0) {
      mostrarToast("Solo podés participar en una rifa a la vez.");
      return;
    }

    // Mostrar loading y números
    btn.textContent = "Comprar";
    paginados.style.display = "block";
    overlay.style.display = "flex";

    // Retrasar renderNumeros para que el overlay se vea
    setTimeout(() => {
      renderNumeros(idx);
      overlay.style.display = "none";
    }, 300); // podés ajustar este delay si querés más tiempo visible
  } else {
    if (seleccionadosPorRifa[idx].size === 0) {
      alert("Seleccioná al menos un número.");
      return;
    }
    mostrarFormulario(idx, rifa);
  }
};
;
}

function mostrarFormulario(idx, rifa) {
  const formulario = document.getElementById("formulario");
  formulario.style.display = "block";
  formulario.reset();

  // Limpiar mensaje descuento y total
  document.getElementById("mensaje-descuento").style.display = "none";
  descuentoAplicado = 0;

  const numsCont = document.getElementById("numeros-container");
  numsCont.innerHTML = "";
  seleccionadosPorRifa[idx].forEach(n => {
    const span = document.createElement("div");
    span.className = "numero seleccionado";
    span.textContent = n;
    numsCont.appendChild(span);
  });
  document.getElementById("rifas-contenedor").classList.add("oculto");

  // Marca qué rifa está activa para el pago
  rifas.forEach(r => r.dataset.activa = "0");
  rifa.dataset.activa = "1";

  actualizarTotal(idx);
}

// Renderiza números en la página actual, bloquea números vendidos y muestra selección
function renderNumeros(idx) {
  const rifa = rifas[idx];
  const cont = rifa.querySelector(".numeros-container");
  const total = parseInt(rifa.dataset.total);
  const padding = parseInt(rifa.dataset.padding);
  const pag = paginas[idx];
  const vendidos = vendidosPorRifa[idx] || [];
  const prev = rifa.querySelector(".prev");
  const next = rifa.querySelector(".next");

  const maxPage = Math.floor((total - 1) / 50);
  prev.disabled = pag === 0;
  next.disabled = pag >= maxPage;

  cont.innerHTML = "";
  for (let i = pag * 50; i < Math.min(pag * 50 + 50, total); i++) {
    const num = i.toString().padStart(padding, "0");
    const div = document.createElement("div");
    div.className = "numero";
    div.textContent = num;
    if (vendidos.includes(num)) div.classList.add("tomado");
    else if (seleccionadosPorRifa[idx].has(num)) div.classList.add("seleccionado");
    div.onclick = () => {
      if (div.classList.contains("tomado")) return;
      // Permitir solo una rifa activa para seleccionar
      const otrasSeleccionadas = Object.entries(seleccionadosPorRifa).some(([k, set]) => parseInt(k) !== idx && set.size > 0);
      if (otrasSeleccionadas) {
        mostrarToast("Solo podés participar en una rifa a la vez.");
        return;
      }
      if (seleccionadosPorRifa[idx].has(num)) {
        seleccionadosPorRifa[idx].delete(num);
        div.classList.remove("seleccionado");
      } else {
        seleccionadosPorRifa[idx].add(num);
        div.classList.add("seleccionado");
      }
      mostrarToast(`${seleccionadosPorRifa[idx].size} número(s) seleccionado(s)`);
    };
    cont.appendChild(div);
  }
}

// Carga números vendidos desde Google Sheets vía scriptURL
function cargarTomados() {
  fetch(scriptURL)
    .then(r => r.json())
    .then(data => {
      const todos = data.takenNumbers || [];
      rifasData.forEach((cfg, i) => {
        const filtrados = todos.filter(n => n.length === cfg.padding);
        vendidosPorRifa[i] = filtrados;
      });
      // Para la primera rifa que se expanda, se actualizarán los números tomados
      rifas.forEach((_, idx) => {
        const rifa = rifas[idx];
        const paginados = rifa.querySelector(".numeros-paginados");
        if (paginados.style.display === "block") {
          renderNumeros(idx);
        }
      });
    })
    .catch(() => {
      mostrarToast("Error al cargar números vendidos.");
    });
}

// Actualiza el total a pagar en el formulario considerando descuento
function actualizarTotal(idx) {
  const rifa = rifas[idx];
  const valorUnitario = parseFloat(rifa.dataset.valor);
  const cantidad = seleccionadosPorRifa[idx].size;
  let total = cantidad * valorUnitario;

  if (descuentoAplicado > 0) {
    total = total - (total * descuentoAplicado / 100);
  }

  document.getElementById("total-pagar").textContent = total.toLocaleString("es-AR");
}

// Validar código de descuento al cambiar el campo
document.getElementById("codigo-descuento").addEventListener("input", function() {
  const codigo = this.value.trim().toUpperCase();
  const mensajeDesc = document.getElementById("mensaje-descuento");
  if (!codigo) {
    descuentoAplicado = 0;
    mensajeDesc.style.display = "none";
    actualizarTotal(rifas.findIndex(r => r.dataset.activa === "1"));
    return;
  }
  if (codigosDescuentoValidos[codigo] !== undefined) {
    descuentoAplicado = codigosDescuentoValidos[codigo];
    mensajeDesc.style.color = "green";
    mensajeDesc.textContent = `Código válido: ${descuentoAplicado}% de descuento aplicado.`;
    mensajeDesc.style.display = "block";
  } else {
    descuentoAplicado = 0;
    mensajeDesc.style.color = "red";
    mensajeDesc.textContent = "Código inválido o expirado.";
    mensajeDesc.style.display = "block";
  }
  actualizarTotal(rifas.findIndex(r => r.dataset.activa === "1"));
});

// Formulario: Envío simulado para mostrar ticket directo sin Mercado Pago
document.getElementById("formulario").onsubmit = async e => {
  e.preventDefault();
  const btn = document.getElementById("btn-pagar");
  const spinner = document.getElementById("spinner");
  btn.disabled = true;
  spinner.style.display = "inline-block";

  // Datos del formulario
  const form = e.target;
  const nombre = form.nombre.value.trim();
  const dni = form.dni.value.trim();
  const email = form.email.value.trim();
  const telefono = form.telefono.value.trim();
  const localidad = form.localidad.value.trim();
  const codigoDescuento = form["codigo-descuento"].value.trim().toUpperCase();

  const idxRifaActiva = rifas.findIndex(r => r.dataset.activa === "1");
  if (idxRifaActiva === -1) {
    mostrarToast("No hay rifa activa para pagar.");
    btn.disabled = false;
    spinner.style.display = "none";
    return;
  }

  const numeros = Array.from(seleccionadosPorRifa[idxRifaActiva]);
  if (numeros.length === 0) {
    mostrarToast("Seleccioná al menos un número.");
    btn.disabled = false;
    spinner.style.display = "none";
    return;
  }

  // Calcular total con descuento
  const valorUnitario = parseFloat(rifas[idxRifaActiva].dataset.valor);
  let totalPagar = numeros.length * valorUnitario;
  if (descuentoAplicado > 0) {
    totalPagar = totalPagar - (totalPagar * descuentoAplicado / 100);
  }

  // Generar UID simple
  const uid = 'UID-' + Date.now() + '-' + Math.floor(Math.random() * 10000);

  // **Definir fechas para ticket**
  const fechaHoraAdquisicion = new Date().toLocaleString("es-AR", {
    day: "2-digit", month: "2-digit", year: "numeric",
    hour: "2-digit", minute: "2-digit"
  });

  const fechaSorteo = getTextoPorRifa(parseInt(rifas[idxRifaActiva].dataset.rifa)).fechaSorteo;

  // Crear objeto datos para el ticket
  const datosParaTicket = {
    nombre,
    dni,
    email,
    telefono,
    localidad,
    rifa: rifas[idxRifaActiva].dataset.rifa,
    numeros,
    codigoDescuento,
    descuentoAplicado,
    totalPagar: totalPagar.toLocaleString("es-AR"),
    uid,
    fechaHoraAdquisicion,
    fechaSorteo
  };

  // Guardar en localStorage para mostrar ticket
  localStorage.setItem("ticketData", JSON.stringify(datosParaTicket));

  
  // Mostrar ticket directamente
mostrarTicket(datosParaTicket);

// Enviar datos a la hoja de cálculo
const formData = new FormData();
formData.append("datos", JSON.stringify(datosParaTicket));

fetch(scriptURL, {
  method: "POST",
  body: formData
});

btn.disabled = false;
spinner.style.display = "none";
};



// Mostrar ticket después del pago, si hay datos en localStorage
window.onload = () => {
  // Banner bienvenida con persistencia
  const banner = document.getElementById("banner-bienvenida");
  const btnCerrarBanner = document.getElementById("cerrar-banner");
  
  btnCerrarBanner.onclick = () => {
    banner.style.display = "none";
    localStorage.setItem("bannerCerrado", "true");
  };

  // Renderizar rifas y cargar números vendidos
  renderRifas();
  cargarTomados();

  // Mostrar ticket si hay datos
  const ticketDataJSON = localStorage.getItem("ticketData");
  if (ticketDataJSON) {
    const ticketData = JSON.parse(ticketDataJSON);
    mostrarTicket(ticketData);
  }
};

// Función para mostrar el ticket de compra con QR y botón "Volver a comprar rifa"
function mostrarTicket(data) {
  document.getElementById("formulario").style.display = "none";
  document.getElementById("rifas-contenedor").style.display = "none";
  const ticket = document.getElementById("ticket");
  ticket.style.display = "block";

  const logoURL = "https://i.ibb.co/nMHBVFXf/logo-R.png"; 

  const datosDiv = document.getElementById("datos");
  datosDiv.innerHTML = `
    <div style="text-align:center; margin-bottom: 15px;">
      <img src="${logoURL}" alt="Logo" style="max-width: 200px; height: auto;" />
    </div>
    <p><strong>Nombre:</strong> ${data.nombre}</p>
    <p><strong>DNI:</strong> ${data.dni}</p>
    <p><strong>Teléfono:</strong> ${data.telefono}</p>
    <p><strong>Localidad:</strong> ${data.localidad}</p>
    <p><strong>Rifa:</strong> ${data.rifa}</p>
    <p><strong>Números:</strong> ${data.numeros.join(", ")}</p>
    <p><strong>Total pagado:</strong> $${data.totalPagar}</p>
    <p><strong>UID:</strong> ${data.uid}</p>
    <p><strong>Código de descuento:</strong> ${data.codigoDescuento || 'Ninguno'}</p>
    <p><strong>Fecha y hora de adquisición:</strong> ${data.fechaHoraAdquisicion || '-'}</p>
    <p><strong>Fecha y hora del sorteo:</strong> ${data.fechaSorteo ? new Date(data.fechaSorteo).toLocaleString("es-AR", {
      day: "2-digit", month: "2-digit", year: "numeric",
      hour: "2-digit", minute: "2-digit"
    }) : '-'}</p>
    <div id="qrcode" style="text-align:center; margin: 20px 0;"></div>
    <div style="text-align:center; margin-bottom: 10px;">
      <button id="btn-volver" style="padding: 10px 20px; cursor: pointer;">Volver a comprar rifa</button>
    </div>
  `;

  const qrcodeContainer = document.getElementById("qrcode");
  qrcodeContainer.innerHTML = "";
  new QRCode(qrcodeContainer, {
    text: data.uid,
    width: 150,
    height: 150,
  });

  document.getElementById("btn-volver").onclick = () => {
    location.reload();
  


    
    // Mostrar rifas
    document.getElementById("rifas-contenedor").style.display = "block";
    
    // Mostrar banner bienvenida si no está cerrado
    const banner = document.getElementById("banner-bienvenida");
    if (localStorage.getItem("bannerCerrado") !== "true") {
      banner.style.display = "block";
    }
    
    // Ocultar formulario
    document.getElementById("formulario").style.display = "none";
    
    // Limpiar localStorage
    localStorage.removeItem("ticketData");
    
    // Resetear selecciones y estados
    seleccionadosPorRifa = {};
    rifas.forEach((r, i) => {
      seleccionadosPorRifa[i] = new Set();
      paginas[i] = 0;
      r.querySelector(".btn-participar").textContent = "Desplegar Números";
      r.querySelector(".numeros-paginados").style.display = "none";
    });
  };
}

const btnDescargar = document.getElementById("descargar");
if (btnDescargar) {
  btnDescargar.onclick = () => {
    const ticket = document.getElementById("ticket");
    html2canvas(ticket).then(canvas => {
      const link = document.createElement("a");
      link.download = `Ticket-Rifa-${Date.now()}.png`;
      link.href = canvas.toDataURL("image/png");
      link.click();
    });
  };
}

</script>


  <script>
  document.getElementById('cerrar-banner').addEventListener('click', function () {
    document.getElementById('banner-bienvenida').style.display = 'none';
  });
</script>
<footer class="pie-pagina">
  <div class="barra-seguridad">
    <div class="logos">
      <img src="https://http2.mlstatic.com/storage/pog-cm-admin/calm-assets/3_C_fondoA--320x208--c9a7f1a0--rebrand-mp.webp?refresh=1" alt="Mercado Pago" />
      <img src="https://firmaprofesional.com/wp-content/uploads/2024/06/segured-negativo-1-1-1024x450.png" alt="SSL Seguro" />
      <img src="https://cdn-icons-png.flaticon.com/512/456/456212.png" alt="Protección de datos" />
    </div>
    <div class="texto">
      <p><i class="fas fa-lock"></i> Pagos 100% seguros a través de Mercado Pago</p>
  <p><i class="fas fa-check-circle"></i> Tus datos están protegidos con encriptación SSL</p>
  <p><i class="fas fa-file-alt"></i> Participación transparente. Recibirás tu ticket con QR tras el pago.</p>
  <p><i class="fas fa-lightbulb"></i> Seleccioná tus números, completá tus datos y pagá con confianza</p>
    </div>
  </div>

  <div class="barra-instrucciones">
    <p>INSTRUCCIONES:</p>
    <p>1. Seleccioná una rifa según la cantidad de cifras que desees (2, 3 o 4 cifras).</p>
    <p>2. Hacé clic en “Participar”, seleccioná tus números disponibles y luego presioná “Comprar”.</p>
    <p>3. Completá el formulario con tus datos reales y realizá el pago con Mercado Pago.</p>
    <p>4. Al volver del pago exitoso, recibirás tu ticket personalizado con código QR.</p>
    <p>5. Podrás descargar tu ticket como comprobante. ¡Mucha suerte en el sorteo! Ya sabes a que ONG o Club vas a ayudar?</p>
  </div>

  <div class="barra-legales">
    <p><a href="#" onclick="alert('Terminos y Condiciones: No se encontro el archivo'); return false;">Términos y condiciones</a> | <a href="#" onclick="alert('Política de privacidad: No se encontro el archivo'); return false;">Política de privacidad</a></p>
    <p>&copy; 2025 Rifa$ueldo. Todos los derechos reservados.</p>
  </div>
</footer>


  <script>
  const waBox = document.getElementById('wa-slidebox');
  const waToggle = document.getElementById('wa-toggle');

  document.getElementById('wa-toggle').addEventListener('click', () => {
  document.getElementById('wa-slidebox').classList.toggle('open');
});
    
</script>
  <script>
function iniciarContador(fechaSorteoStr) {
  const contador = document.getElementById("contador-sorteo");
  if (!contador) return;

  const fechaSorteo = new Date(fechaSorteoStr).getTime();

  function actualizar() {
    const ahora = new Date().getTime();
    const diferencia = fechaSorteo - ahora;

    if (diferencia <= 0) {
      contador.textContent = "¡Sorteo en curso o finalizado!";
      clearInterval(intervalo);
      return;
    }

    const dias = Math.floor(diferencia / (1000 * 60 * 60 * 24));
    const horas = Math.floor((diferencia / (1000 * 60 * 60)) % 24);
    const minutos = Math.floor((diferencia / (1000 * 60)) % 60);
    const segundos = Math.floor((diferencia / 1000) % 60);

    contador.textContent = `Faltan ${dias}d ${horas}h ${minutos}m ${segundos}s`;
  }

  actualizar(); // Llamar de inmediato
  const intervalo = setInterval(actualizar, 1000);
}

// Iniciar el contador para la fecha del sorteo
iniciarContador("2025-07-16T21:00:00");
</script>


</body>
</html>
